# Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

# typed: true
# frozen_string_literal: true

require_relative './types'


module UnifiedRubySDK
  module SDKHooks
    class Hooks
      extend T::Sig

      sig { void }
      def initialize
        @sdk_init_hooks = T.let([], T::Array[AbstractSDKHook])
        @before_request_hooks = T.let([], T::Array[AbstractSDKHook])
        @after_success_hooks = T.let([], T::Array[AbstractSDKHook])
        @after_error_hooks = T.let([], T::Array[AbstractSDKHook])
      end

      sig { params(hook: AbstractSDKHook).void }
      def register_sdk_init_hook(hook)
        @sdk_init_hooks << hook
      end

      sig { params(hook: AbstractSDKHook).void }
      def register_before_request_hook(hook)
        @before_request_hooks << hook
      end

      sig { params(hook: AbstractSDKHook).void }
      def register_after_success_hook(hook)
        @after_success_hooks << hook
      end

      sig { params(hook: AbstractSDKHook).void }
      def register_after_error_hook(hook)
        @after_error_hooks << hook
      end

      sig { params(config: SDKConfiguration).returns(SDKConfiguration) }
      def sdk_init(config:)
        @sdk_init_hooks.each do |hook|
          config = hook.sdk_init(config: config)
        end

        return config
      end

      sig do
        params(
          hook_ctx: BeforeRequestHookContext,
          request: Faraday::Request
        ).returns(Faraday::Request)
      end
      def before_request(hook_ctx:, request:)
        @before_request_hooks.each do |hook|
          request = hook.before_request(hook_ctx: hook_ctx, request: request)
        end

        request
      end

      sig do
        params(
          hook_ctx: AfterSuccessHookContext,
          response: Faraday::Response
        ).returns(Faraday::Response)
      end
      def after_success(hook_ctx:, response:)
        @after_success_hooks.each do |hook|
          response = hook.after_success(hook_ctx: hook_ctx, response: response)
        end

        response
      end

      sig do
        params(
          error: T.nilable(StandardError),
          hook_ctx: AfterErrorHookContext,
          response: T.nilable(Faraday::Response)
        ).returns(T.nilable(Faraday::Response))
      end
      def after_error(error:, hook_ctx:, response:)
        @after_error_hooks.each do |hook|
          response = hook.after_error(error: error, hook_ctx: hook_ctx, response: response)
        end

        response
      end
    end
  end
end
